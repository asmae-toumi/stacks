<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Evaluate a data stack — blend_predictions • stacks</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>

<!-- Bootstrap -->
<link href="../tidyverse.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>
<link href="../tidyverse-2.css" rel="stylesheet">

<!--optional theme-->
<link href="../tidymodels.css" rel="stylesheet">




<meta property="og:title" content="Evaluate a data stack — blend_predictions" />
<meta property="og:description" content="Evaluates a stack by performing regularization on the out-of-sample
predictions to determine coefficients for the combining of predictions
from ensemble members." />
<meta name="twitter:card" content="summary" />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->

<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>

  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <div class="navbar-brand-container">
        <a class="navbar-brand" href="../index.html">stacks</a>
        <div class="info hidden-xs hidden-sm">
          <span class="partof">part of <a href="https://github.com/tidymodels">tidymodels</a></span>
          <span class="version version-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
        </div>
      </div>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/basics.html">Getting Started With stacks</a>
    </li>
    <li>
      <a href="../articles/classification.html">Classification Models With stacks</a>
    </li>
  </ul>
</li>
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Evaluate a data stack</h1>
    
    <div class="hidden name"><code>blend_predictions.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Evaluates a stack by performing regularization on the out-of-sample
predictions to determine coefficients for the combining of predictions
from ensemble members.</p>
    </div>

    <pre class="usage"><span class='fu'>blend_predictions</span>(<span class='kw'>data_stack</span>, penalty = <span class='fl'>10</span><span class='op'>^</span>(<span class='op'>-</span><span class='fl'>6</span><span class='op'>:</span><span class='op'>-</span><span class='fl'>1</span>), verbose = <span class='fl'>FALSE</span>, <span class='kw'>...</span>)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data_stack</th>
      <td><p>A <code>data_stack</code> object</p></td>
    </tr>
    <tr>
      <th>penalty</th>
      <td><p>A numeric vector of proposed penalty values used in member
weighting. Higher penalties will generally result in fewer members
being included in the resulting model stack, and vice versa. This argument
will be tuned on unless a single penalty value is given.</p></td>
    </tr>
    <tr>
      <th>verbose</th>
      <td><p>A logical for logging results as they are generated. Despite
this argument, warnings and errors are always shown.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>Additional arguments. Currently ignored.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A <code>model_stack</code> object—while <code>model_stacks</code> largely contain the
same elements as <code>data_stack</code>s, the primary data objects shift from the
assessment set predictions to the member models.</p>
    <h2 class="hasAnchor" id="example-data"><a class="anchor" href="#example-data"></a>Example Data</h2>

    


<p>These examples make use of data and resampling objects exported with the
package. All of them are derived from test cases making use of the
<code>penguins</code> dataset from Allison Horst's <code>palmerpenguins</code> package.</p>
<p>The <code>penguins_train</code> and <code>penguins_test</code> objects are subsets of the
penguins data for using in training and testing, respectively.</p>
<p>Objects containing the substring <code>_res_</code> are <code>tune_results</code> objects
for model specifications. The <code>reg</code> prefix indicates that the model
definition is for use in regression, <code>class</code> indicates multinomial
classification, and <code>log</code> (as in logistic) indicates binomial classification.
The suffix indicates the model definition type. All of these <code>tune_results</code>
objects are fitted on a 5-fold cross validation of the <code>penguins_train</code> data.</p>
<p>For the regression setting, these <code>tune_results</code> objects reflect
models specified to fit <code>body_mass_g</code> using all of the other variables
as predictors. These objects include:</p><ul>
<li><p><code>reg_res_lr</code>: Fitted resamples for a linear regression model</p></li>
<li><p><code>reg_res_sp</code>: Tuning results for a splines model</p></li>
<li><p><code>reg_res_svm</code>: Tuning results for a support vector machine model</p></li>
</ul>

<p>In the multinomial classification setting, the relevant objects reflect
models specified to fit <code>year</code> (as a factor) using all of the other variables
as predictors. These objects include:</p><ul>
<li><p><code>class_res_nn</code>: Fitted resamples for a neural network model</p></li>
<li><p><code>class_res_rf</code>: Tuning results for a random forest model</p></li>
</ul>

<p>In the binomial classification setting, the relevant objects reflect models
specified to fit <code>sex</code> using all of the other variables as predictors.
These objects include:</p><ul>
<li><p><code>log_res_nn</code>: Fitted resamples for a neural network model</p></li>
<li><p><code>log_res_rf</code>: Tuning results for a random forest model</p></li>
</ul>

<p>See <code><a href='example_data.html'>?example_data</a></code> to learn more about these objects, as well as browse
the source code that generated them.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p>Other core verbs: 
<code><a href='add_candidates.html'>add_candidates</a>()</code>,
<code><a href='fit_members.html'>fit_members</a>()</code>,
<code><a href='stacks.html'>stacks</a>()</code></p></div>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='co'># see the "Example Data" section above for</span>
<span class='co'># clarification on the objects used in these examples!</span>

<span class='co'># put together a data stack</span>
<span class='kw'>reg_st</span> <span class='op'>&lt;-</span> 
  <span class='fu'><a href='stacks.html'>stacks</a></span>() <span class='op'>%&gt;%</span>
  <span class='fu'><a href='add_candidates.html'>add_candidates</a></span>(<span class='kw'>reg_res_lr</span>) <span class='op'>%&gt;%</span>
  <span class='fu'><a href='add_candidates.html'>add_candidates</a></span>(<span class='kw'>reg_res_svm</span>) <span class='op'>%&gt;%</span>
  <span class='fu'><a href='add_candidates.html'>add_candidates</a></span>(<span class='kw'>reg_res_sp</span>)
  
<span class='kw'>reg_st</span>
</div><div class='output co'>#&gt; # A data stack with 3 model definitions and 16 candidate members:
#&gt; #   reg_res_lr: 1 sub-model
#&gt; #   reg_res_svm: 5 sub-models
#&gt; #   reg_res_sp: 10 sub-models
#&gt; # Outcome: latency (numeric)</div><div class='input'>
<span class='co'># evaluate the data stack</span>
<span class='kw'>reg_st</span> <span class='op'>%&gt;%</span>
  <span class='fu'>blend_predictions</span>()
</div><div class='output co'>#&gt; <span class='message'>── A stacked ensemble model ─────────────────────────────────────</span></div><div class='output co'>#&gt; <span class='message'>Out of 16 possible candidates, the ensemble contains 5 members.</span></div><div class='output co'>#&gt; <span class='message'>The highest weighted members are:</span></div><div class='output co'>#&gt; <span style='color: #555555;'># A tibble: 5 x 3</span><span>
#&gt;   member       type       weight
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> reg_res_svm4 svm_rbf    1.58  
#&gt; </span><span style='color: #555555;'>2</span><span> reg_res_svm3 svm_rbf    0.936 
#&gt; </span><span style='color: #555555;'>3</span><span> reg_res_sp06 linear_reg 0.216 
#&gt; </span><span style='color: #555555;'>4</span><span> reg_res_sp10 linear_reg 0.124 
#&gt; </span><span style='color: #555555;'>5</span><span> reg_res_svm5 svm_rbf    0.045</span><span style='text-decoration: underline;'>0</span><span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Members have not yet been fitted with `fit_members()`.</span></div><div class='input'>
<span class='co'># include fewer models by proposing</span>
<span class='co'># higher penalties</span>
<span class='kw'>reg_st</span> <span class='op'>%&gt;%</span> <span class='fu'>blend_predictions</span>(penalty = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='fl'>.5</span>, <span class='fl'>1</span>))
</div><div class='output co'>#&gt; <span class='message'>── A stacked ensemble model ─────────────────────────────────────</span></div><div class='output co'>#&gt; <span class='message'>Out of 16 possible candidates, the ensemble contains 5 members.</span></div><div class='output co'>#&gt; <span class='message'>The highest weighted members are:</span></div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 5 x 3</span><span>
#&gt;   member       type       weight
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>       </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> reg_res_svm4 svm_rbf    1.58  
#&gt; </span><span style='color: #555555;'>2</span><span> reg_res_svm3 svm_rbf    0.936 
#&gt; </span><span style='color: #555555;'>3</span><span> reg_res_sp06 linear_reg 0.216 
#&gt; </span><span style='color: #555555;'>4</span><span> reg_res_sp10 linear_reg 0.124 
#&gt; </span><span style='color: #555555;'>5</span><span> reg_res_svm5 svm_rbf    0.045</span><span style='text-decoration: underline;'>0</span><span></div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Members have not yet been fitted with `fit_members()`.</span></div><div class='input'>  
<span class='co'># do the same with multinomial classification models</span>
<span class='kw'>class_st</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='stacks.html'>stacks</a></span>() <span class='op'>%&gt;%</span>
  <span class='fu'><a href='add_candidates.html'>add_candidates</a></span>(<span class='kw'>class_res_nn</span>) <span class='op'>%&gt;%</span>
  <span class='fu'><a href='add_candidates.html'>add_candidates</a></span>(<span class='kw'>class_res_rf</span>) <span class='op'>%&gt;%</span>
  <span class='fu'>blend_predictions</span>()
</div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> </span><span style='color: #BBBB00;'>Fold2: model 1/1: from glmnet Fortran code (error code -87); Convergence for 87...</span><span></span></div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> </span><span style='color: #BBBB00;'>Fold5: model 1/1: from glmnet Fortran code (error code -84); Convergence for 84...</span><span></span></div><div class='input'>  
<span class='kw'>class_st</span>
</div><div class='output co'>#&gt; <span class='message'>── A stacked ensemble model ─────────────────────────────────────</span></div><div class='output co'>#&gt; <span class='message'>Out of 22 possible candidates, the ensemble contains 5 members.</span></div><div class='output co'>#&gt; <span class='message'>Across the 3 classes, there are an average of 2.5 members per class.</span></div><div class='output co'>#&gt; <span class='message'>The highest weighted member classes are:</span></div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 5 x 4</span><span>
#&gt;   member                    type         weight class
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                     </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>         </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span> </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> .pred_full_class_res_nn1  mlp         19.4    full 
#&gt; </span><span style='color: #555555;'>2</span><span> .pred_mid_class_res_rf06  rand_forest  3.47   mid  
#&gt; </span><span style='color: #555555;'>3</span><span> .pred_full_class_res_rf05 rand_forest  1.65   full 
#&gt; </span><span style='color: #555555;'>4</span><span> .pred_full_class_res_rf03 rand_forest  0.315  full 
#&gt; </span><span style='color: #555555;'>5</span><span> .pred_full_class_res_rf02 rand_forest  0.047</span><span style='text-decoration: underline;'>7</span><span> full </div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Members have not yet been fitted with `fit_members()`.</span></div><div class='input'>
<span class='co'># ...or binomial classification models</span>
<span class='kw'>log_st</span> <span class='op'>&lt;-</span>
  <span class='fu'><a href='stacks.html'>stacks</a></span>() <span class='op'>%&gt;%</span>
  <span class='fu'><a href='add_candidates.html'>add_candidates</a></span>(<span class='kw'>log_res_nn</span>) <span class='op'>%&gt;%</span>
  <span class='fu'><a href='add_candidates.html'>add_candidates</a></span>(<span class='kw'>log_res_rf</span>) <span class='op'>%&gt;%</span>
  <span class='fu'>blend_predictions</span>()
  
<span class='kw'>log_st</span>
</div><div class='output co'>#&gt; <span class='message'>── A stacked ensemble model ─────────────────────────────────────</span></div><div class='output co'>#&gt; <span class='message'>Out of 11 possible candidates, the ensemble contains 2 members.</span></div><div class='output co'>#&gt; <span class='message'>The highest weighted member classes are:</span></div><div class='output co'>#&gt; </span><span style='color: #555555;'># A tibble: 2 x 3</span><span>
#&gt;   member                 type        weight
#&gt;   </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>                  </span><span style='color: #555555;font-style: italic;'>&lt;chr&gt;</span><span>        </span><span style='color: #555555;font-style: italic;'>&lt;dbl&gt;</span><span>
#&gt; </span><span style='color: #555555;'>1</span><span> .pred_yes_log_res_nn1  mlp           7.93
#&gt; </span><span style='color: #555555;'>2</span><span> .pred_yes_log_res_rf05 rand_forest   2.83</div><div class='output co'>#&gt; <span class='message'></span>
#&gt; <span class='message'>Members have not yet been fitted with `fit_members()`.</span></div><div class='input'><span class='co'># }</span>

</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="tidyverse">
  <p>stacks is a part of the <strong>tidymodels</strong> ecosystem, a collection of modeling packages designed with common APIs and a shared philosophy.</p>
</div>

<div class="author">
  <p>
    Developed by Simon Couch, Max Kuhn.
    Site built by <a href="https://pkgdown.r-lib.org">pkgdown</a>.
  </p>
</div>

      </footer>
   </div>

  


  </body>
</html>


